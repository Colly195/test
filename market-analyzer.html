<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Analyzer - RoyalTraders</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --text-primary: #2c3e50;
            --text-secondary: #6c757d;
            --accent-green: #27ae60;
            --accent-red: #e74c3c;
            --accent-blue: #3498db;
            --border-color: #dee2e6;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            --card-radius: 12px;
        }
        [data-theme="dark"] {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --text-primary: #ffffff;
            --text-secondary: #adb5bd;
            --border-color: #495057;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            --accent-blue: #4fc3f7;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            margin: 0;
            padding: 0;
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
            overflow-x: hidden;
        }
        .hidden { display: none !important; }
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        .card {
            background: var(--bg-primary);
            border-radius: var(--card-radius);
            box-shadow: var(--shadow);
            padding: 1rem;
            border: 1px solid var(--border-color);
            box-sizing: border-box;
        }
        .section { margin-bottom: 1.5rem; }
        .section-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
            border-bottom: 2px solid var(--accent-blue);
            padding-bottom: 0.25rem;
        }
        .top-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        .logo { width: 20px; height: 20px; }
        .logo-text { font-weight: 700; font-size: 1.1rem; }
        .header-right { display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap; }
        .main-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 1rem;
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            position: relative;
        }
        .nav-links-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
            max-width: 100%;
            overflow-x: auto;
        }
        .nav-link {
            display: flex;
            align-items: center;
            padding: 0.4rem 0.8rem;
            text-decoration: none;
            color: var(--text-secondary);
            border-radius: 6px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        .nav-link:hover, .nav-link.active {
            background: var(--accent-blue);
            color: white;
        }
        .nav-link i { margin-right: 0.4rem; font-size: 0.9rem; }
        .nav-right-actions { display: flex; align-items: center; gap: 0.5rem; }
        .status-tag {
            padding: 0.2rem 0.6rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        .status-tag.running { background: var(--accent-green); color: white; }
        .status-tag.not-running { background: #ffc107; color: #212529; }
        .btn {
            padding: 0.4rem 0.8rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        .btn-run {
            background: var(--accent-green);
            color: white;
            padding: 0.5rem 1rem;
        }
        .btn-run:hover { background: #219a52; }
        .btn-secondary { background: var(--accent-blue); color: white; }
        .btn-secondary:hover { background: #2980b9; }
        .btn-sm { padding: 0.2rem 0.4rem; font-size: 0.8rem; }
        .main-content {
            padding: 1rem;
            max-width: 100%;
            margin: 0 auto;
            box-sizing: border-box;
            min-height: calc(100vh - 120px);
        }
        .warning-bar {
            background: var(--bg-secondary);
            padding: 0.5rem 1rem;
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.85rem;
        }
        .main-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
        }
        .footer-btn {
            background: none;
            border: none;
            font-size: 1rem;
            cursor: pointer;
            color: var(--text-secondary);
        }
        .footer-btn:hover { color: var(--accent-blue); }
        .hamburger {
            display: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-primary);
            background: none;
            border: none;
        }
        /* Market Analyzer Specific Styles */
        .page-heading {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        .page-subheading {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }
        .analysis-config-card { background: var(--bg-secondary); }
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        .form-group { display: flex; flex-direction: column; }
        .form-label {
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
            font-size: 0.9rem;
        }
        .form-control {
            padding: 0.4rem 0.6rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 0.9rem;
        }
        .form-control:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 2px var(--accent-blue);
        }
        .form-text {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }
        .current-price-section { text-align: center; }
        .price-title {
            font-size: 1rem;
            color: var(--text-secondary);
            margin: 0;
        }
        .price-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0.5rem 0;
        }
        .price-stats {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 0.75rem;
        }
        .stat { text-align: center; }
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
        }
        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin: 0;
        }
        .even-count { color: var(--accent-blue); }
        .odd-count { color: var(--accent-red); }
        .recent-pattern-card { text-align: center; }
        .pattern-dots {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }
        .dot-container {
            text-align: center;
            width: 50px;
        }
        .dot {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1rem;
            font-weight: 700;
            color: white;
            margin: 0 auto;
        }
        .even-dot { background: var(--accent-blue); }
        .odd-dot { background: var(--accent-red); }
        .dot-label {
            font-size: 0.8rem;
            margin-top: 0.25rem;
            color: var(--text-primary);
            font-weight: 500;
        }
        .probability-card { text-align: center; }
        .probability-bar-container {
            width: 80%;
            height: 40px;
            background: #e0e0e0;
            border-radius: 20px;
            margin: 1rem auto;
            display: flex;
            position: relative;
            overflow: hidden;
        }
        .even-bar, .odd-bar {
            height: 100%;
            transition: width 0.5s ease-in-out;
            position: relative;
        }
        .even-bar { background: var(--accent-blue); }
        .odd-bar { background: var(--accent-red); }
        .even-label, .odd-label {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            font-weight: 700;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            white-space: nowrap;
        }
        .even-label { left: 10px; }
        .odd-label { right: 10px; }
        .probability-label {
            display: flex;
            justify-content: space-between;
            width: 80%;
            margin: 0 auto;
            font-weight: 500;
            font-size: 0.9rem;
        }
        .trading-guide-card, .signal-strength-card { margin-top: 1rem; }
        .guide-header {
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--accent-blue);
            border-bottom: 2px solid var(--accent-blue);
            padding-bottom: 0.25rem;
        }
        .guide-section {
            display: flex;
            justify-content: space-between;
            gap: 1rem;
            margin-top: 0.75rem;
        }
        .guide-subsection {
            flex: 1;
            text-align: center;
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 0.75rem;
        }
        .guide-subsection h3 {
            color: var(--text-primary);
            font-size: 1rem;
            margin: 0 0 0.5rem 0;
            padding-bottom: 0.25rem;
            border-bottom: 1px solid var(--border-color);
        }
        .guide-row { margin-bottom: 0.5rem; }
        .guide-row-header {
            background: var(--accent-blue);
            color: white;
            font-weight: 700;
            border-radius: 5px;
            padding: 0.3rem;
            display: flex;
            justify-content: space-around;
        }
        .guide-row-data {
            color: var(--text-primary);
            display: flex;
            justify-content: space-around;
        }
        .guide-row-data span { flex: 1; }
        .guide-section-signal { display: flex; flex-direction: column; align-items: center; }
        .signal-header-row {
            display: flex;
            justify-content: space-around;
            width: 100%;
            background: var(--accent-blue);
            color: white;
            font-weight: 700;
            padding: 0.5rem 0;
            border-radius: 5px;
            margin-bottom: 0.5rem;
        }
        .signal-row {
            display: flex;
            justify-content: space-around;
            width: 100%;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-color);
        }
        .signal-row:last-child { border-bottom: none; }
        .signal-row span { flex: 1; text-align: center; }
        .signal-strength { font-weight: 700; }
        @media (max-width: 768px) {
            .nav-links-container {
                display: none;
                flex-direction: column;
                width: 100%;
                background: var(--bg-primary);
                position: absolute;
                top: 100%;
                left: 0;
                padding: 1rem;
                z-index: 10;
                border-top: 1px solid var(--border-color);
            }
            .nav-links-container.active { display: flex; }
            .hamburger { display: block; }
            .top-header, .main-content, .main-footer { padding: 0.5rem; }
            .form-grid { grid-template-columns: 1fr; }
            .page-heading { font-size: 1.25rem; }
            .page-subheading { font-size: 0.9rem; }
            .price-value { font-size: 1.5rem; }
            .price-stats { gap: 1rem; }
            .stat-value { font-size: 1.2rem; }
            .stat-label { font-size: 0.8rem; }
            .dot { width: 30px; height: 30px; font-size: 0.9rem; }
            .dot-container { width: 40px; }
            .probability-bar-container { width: 90%; height: 30px; }
            .guide-section { flex-direction: column; }
            .btn { padding: 0.3rem 0.6rem; font-size: 0.8rem; }
            .btn-run { padding: 0.4rem 0.8rem; }
        }
        @media (max-width: 480px) {
            .logo-text { font-size: 1rem; }
            .btn-sm { padding: 0.15rem 0.3rem; font-size: 0.75rem; }
            .price-value { font-size: 1.2rem; }
            .section-title { font-size: 1.1rem; }
            .form-label { font-size: 0.8rem; }
            .form-control { font-size: 0.8rem; }
            .dot { width: 25px; height: 25px; font-size: 0.8rem; }
            .dot-label { font-size: 0.7rem; }
        }
    </style>
</head>
<body data-theme="light">
    <header class="top-header">
        <div class="header-left">
            <svg class="logo" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2L2 7V17L12 22L22 17V7L12 2ZM12 4.144L20 8.5L12 12.856L4 8.5L12 4.144ZM4 10.5L11 14.5V20.856L4 16.5V10.5ZM13 14.5L20 10.5V16.5L13 20.856V14.5Z"/>
            </svg>
            <span class="logo-text">RoyalTraders</span>
        </div>
        <div class="header-right">
            <div id="user-display" class="user-info-container hidden" style="display: flex; align-items: center; gap: 0.5rem;">
                <div id="user-initials" style="background-color: #5c6bc0; color: #fff; width: 30px; height: 30px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-weight: bold;"></div>
                <img id="country-flag" src="" alt="Country Flag" style="width: 25px; height: auto;">
                <span id="user-balance" style="font-weight: bold;"></span>
                <button id="logout-btn" class="btn btn-secondary btn-sm">Log Out</button>
            </div>
            <div id="auth-links" class="auth-links-container">
                <button id="deriv-auth-btn" class="btn btn-secondary">Log in / Sign up with Deriv</button>
            </div>
        </div>
    </header>

    <nav class="main-nav">
        <button class="hamburger" aria-label="Toggle Menu"><i class="fa-solid fa-bars"></i></button>
        <div class="nav-links-container">
            <a href="index.html" class="nav-link" aria-label="Dashboard" data-page="index.html"><i class="fa-solid fa-home"></i><span>Dashboard</span></a>
            <a href="bot-builder.html" class="nav-link" aria-label="Bot Builder" data-page="bot-builder.html"><i class="fa-solid fa-hammer"></i><span>Bot Builder</span></a>
            <a href="analysis-tool.html" class="nav-link" aria-label="Analysis Tool" data-page="analysis-tool.html"><i class="fa-solid fa-chart-line"></i><span>Analysis Tool</span></a>
            <a href="batch-trader.html" class="nav-link" aria-label="Batch Trader" data-page="batch-trader.html"><i class="fa-solid fa-layer-group"></i><span>Batch Trader</span></a>
            <a href="market-analyzer.html" class="nav-link active" aria-label="Market Analyzer" data-page="market-analyzer.html"><i class="fa-solid fa-chart-area"></i><span>Market Analyzer</span></a>
            <a href="frequency-analysis.html" class="nav-link" aria-label="Frequency Analysis" data-page="frequency-analysis.html"><i class="fa-solid fa-calculator"></i><span>Frequency Analysis</span></a>
            <a href="digit-tool.html" class="nav-link" aria-label="Digit Tool" data-page="digit-tool.html"><i class="fa-solid fa-fingerprint"></i><span>Digit Tool</span></a>
            <a href="free-bots.html" class="nav-link" aria-label="Free Bots" data-page="free-bots.html"><i class="fa-solid fa-robot"></i><span>Free Bots</span></a>
            <a href="copy-trader.html" class="nav-link" aria-label="Copy Trader" data-page="copy-trader.html"><i class="fa-solid fa-copy"></i><span>Copy Trader</span></a>
            <a href="charts.html" class="nav-link" aria-label="Charts" data-page="charts.html"><i class="fa-solid fa-chart-bar"></i><span>Charts</span></a>
        </div>
        <div class="nav-right-actions">
            <span id="statusTag" class="status-tag not-running">Not Running</span>
            <button id="runButton" class="btn btn-run"><i class="fa-solid fa-play"></i><span id="runBtnText">Run Analysis</span></button>
        </div>
    </nav>

    <main class="main-content">
        <div data-page-content="market-analyzer.html">
            <h1 class="page-heading">Deriv Market Analyzer</h1>
            <p class="page-subheading">Get a comprehensive overview of current market conditions.</p>

            <div class="card analysis-config-card">
                <h2 class="section-title">Analysis Configuration</h2>
                <form>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="syntheticMarket" class="form-label">Synthetic Market</label>
                            <select class="form-control" id="syntheticMarket">
                                <option value="R_10">Volatility 10 Index</option>
                                <option value="R_25">Volatility 25 Index</option>
                                <option value="R_50">Volatility 50 Index</option>
                                <option value="R_75">Volatility 75 Index</option>
                                <option value="R_100" selected>Volatility 100 Index</option>
                                <option value="JD10">Jump 10 Index</option>
                                <option value="JD25">Jump 25 Index</option>
                                <option value="JD50">Jump 50 Index</option>
                                <option value="JD75">Jump 75 Index</option>
                                <option value="JD100">Jump 100 Index</option>
                                <option value="BOOM1000">Boom 1000 Index</option>
                                <option value="BOOM500">Boom 500 Index</option>
                                <option value="BOOM300">Boom 300 Index</option>
                                <option value="CRASH1000">Crash 1000 Index</option>
                                <option value="CRASH500">Crash 500 Index</option>
                                <option value="CRASH300">Crash 300 Index</option>
                                <option value="STEP">Step Index</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="tradeType" class="form-label">Trade Type</label>
                            <select class="form-control" id="tradeType">
                                <option selected>Even/Odd</option>
                                <option>Over/Under</option>
                                <option>Match/Differ</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group mt-2">
                        <label for="numberOfTicks" class="form-label">Number of Ticks to Analyze</label>
                        <input type="number" class="form-control" id="numberOfTicks" value="500" min="1" max="5000">
                        <small class="form-text">Max 5000 ticks</small>
                    </div>
                </form>
            </div>

            <div class="card current-price-section mt-2">
                <p class="price-title">CURRENT PRICE</p>
                <h1 class="price-value" id="currentPrice">--</h1>
                <div class="price-stats">
                    <div class="stat">
                        <p class="stat-value even-count" id="liveEvenCount">0</p>
                        <p class="stat-label">Even</p>
                    </div>
                    <div class="stat">
                        <p class="stat-value odd-count" id="liveOddCount">0</p>
                        <p class="stat-label">Odd</p>
                    </div>
                </div>
            </div>

            <div class="card recent-pattern-card mt-2">
                <h2 class="section-title">Recent Pattern</h2>
                <div class="pattern-dots" id="recentPatterns"></div>
            </div>

            <div class="card probability-card mt-2">
                <h2 class="section-title">Probability Analysis</h2>
                <div class="probability-bar-container">
                    <div class="even-bar" id="evenProbabilityBar">
                        <span class="even-label" id="evenProbabilityLabel">50%</span>
                    </div>
                    <div class="odd-bar" id="oddProbabilityBar">
                        <span class="odd-label" id="oddProbabilityLabel">50%</span>
                    </div>
                </div>
                <div class="probability-label">
                    <span>Even</span>
                    <span>Odd</span>
                </div>
            </div>

            <div class="card trading-guide-card mt-2">
                <div class="guide-header">Trading Probability Guide</div>
                <div class="guide-section">
                    <div class="guide-subsection">
                        <h3 class="guide-header-title">Over Probabilities</h3>
                        <div class="guide-row">
                            <div class="guide-row-header">
                                <span>1</span>
                                <span>2</span>
                                <span>3</span>
                                <span>4</span>
                            </div>
                        </div>
                        <div class="guide-row">
                            <div class="guide-row-data">
                                <span>90%</span>
                                <span>85%</span>
                                <span>70%</span>
                                <span>60%</span>
                            </div>
                        </div>
                        <div class="guide-row">
                            <div class="guide-row-header">
                                <span>5</span>
                                <span>6</span>
                                <span>7</span>
                                <span>8</span>
                            </div>
                        </div>
                        <div class="guide-row">
                            <div class="guide-row-data">
                                <span>55%</span>
                                <span>40%</span>
                                <span>30%</span>
                                <span>25%</span>
                            </div>
                        </div>
                    </div>
                    <div class="guide-subsection">
                        <h3 class="guide-header-title">Under Probabilities</h3>
                        <div class="guide-row">
                            <div class="guide-row-header">
                                <span>1</span>
                                <span>2</span>
                                <span>3</span>
                                <span>4</span>
                            </div>
                        </div>
                        <div class="guide-row">
                            <div class="guide-row-data">
                                <span>25%</span>
                                <span>30%</span>
                                <span>40%</span>
                                <span>55%</span>
                            </div>
                        </div>
                        <div class="guide-row">
                            <div class="guide-row-header">
                                <span>5</span>
                                <span>6</span>
                                <span>7</span>
                                <span>8</span>
                            </div>
                        </div>
                        <div class="guide-row">
                            <div class="guide-row-data">
                                <span>60%</span>
                                <span>70%</span>
                                <span>85%</span>
                                <span>90%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card signal-strength-card mt-2">
                <div class="guide-header">Signal Strength Guide</div>
                <div class="guide-section-signal">
                    <div class="signal-header-row">
                        <span>Pattern</span>
                        <span>Even/Odd</span>
                        <span>Rise/Fall</span>
                    </div>
                    <div class="signal-row">
                        <span class="signal-strength">Strong</span>
                        <span>90%+</span>
                        <span>90%+</span>
                    </div>
                    <div class="signal-row">
                        <span class="signal-strength">Medium</span>
                        <span>70-89%</span>
                        <span>70-89%</span>
                    </div>
                    <div class="signal-row">
                        <span class="signal-strength">Weak</span>
                        <span>51-69%</span>
                        <span>51-69%</span>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div class="warning-bar">
        <strong>Disclaimer:</strong> Trading involves risk. All analysis tools and bots are for informational purposes only.
    </div>

    <footer class="main-footer">
        <div class="footer-left">
            <span id="dateTime"></span>
        </div>
        <div class="footer-right">
            <button id="settingsToggle" class="footer-btn" aria-label="Settings"><i class="fa-solid fa-cog"></i></button>
            <button id="darkModeToggle" class="footer-btn" aria-label="Toggle dark/light mode"><i class="fa-solid fa-moon"></i></button>
            <div class="language-select" style="display: flex; align-items: center;">
                <button class="footer-btn" aria-label="Select language"><i class="fa-solid fa-globe"></i></button>
                <i class="fa-solid fa-caret-down" style="margin-left: 0.25rem; color: var(--text-secondary);"></i>
            </div>
        </div>
    </footer>

    <script type="module">
        // Deriv Authentication
        document.addEventListener('DOMContentLoaded', () => {
            const APP_ID = '99973';
            const derivAuthBtn = document.getElementById('deriv-auth-btn');
            const userDisplay = document.getElementById('user-display');
            const authLinks = document.getElementById('auth-links');
            const logoutBtn = document.getElementById('logout-btn');
            const userInitials = document.getElementById('user-initials');
            const userBalance = document.getElementById('user-balance');

            if (derivAuthBtn) {
                derivAuthBtn.addEventListener('click', () => {
                    const oauthUrl = `https://oauth.deriv.com/oauth2/authorize?app_id=${APP_ID}&l=en&brand=deriv`;
                    window.location.href = oauthUrl;
                });
            }

            if (logoutBtn) {
                logoutBtn.addEventListener('click', () => {
                    sessionStorage.removeItem('deriv_token');
                    updateUIForLoginState(false);
                    window.location.reload();
                });
            }

            function updateUIForLoginState(isLoggedIn) {
                if (isLoggedIn) {
                    authLinks.classList.add('hidden');
                    userDisplay.classList.remove('hidden');
                    userInitials.textContent = 'RT';
                    userBalance.textContent = '$1,250.00';
                } else {
                    authLinks.classList.remove('hidden');
                    userDisplay.classList.add('hidden');
                }
            }

            const params = new URLSearchParams(window.location.search);
            const token = params.get('token');
            if (token) {
                sessionStorage.setItem('deriv_token', token);
                updateUIForLoginState(true);
                window.history.replaceState({}, document.title, window.location.pathname);
            } else {
                const storedToken = sessionStorage.getItem('deriv_token');
                updateUIForLoginState(!!storedToken);
            }

            // Hamburger Menu
            const hamburger = document.querySelector('.hamburger');
            const navLinks = document.querySelector('.nav-links-container');
            if (hamburger) {
                hamburger.addEventListener('click', () => {
                    navLinks.classList.toggle('active');
                    const icon = hamburger.querySelector('i');
                    icon.classList.toggle('fa-bars');
                    icon.classList.toggle('fa-times');
                });
            }
        });
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Shared Features
            const currentPage = window.location.pathname.split('/').pop() || 'market-analyzer.html';
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.toggle('active', link.dataset.page === currentPage);
            });

            function updateDateTime() {
                const now = new Date();
                document.getElementById('dateTime').textContent = now.toLocaleString('en-US', { timeZone: 'Africa/Nairobi' });
            }
            updateDateTime();
            setInterval(updateDateTime, 1000);

            const darkModeToggle = document.getElementById('darkModeToggle');
            darkModeToggle.addEventListener('click', () => {
                const body = document.body;
                const currentTheme = body.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                body.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                darkModeToggle.querySelector('i').className = newTheme === 'dark' ? 'fa-solid fa-sun' : 'fa-solid fa-moon';
            });
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.body.setAttribute('data-theme', savedTheme);
            darkModeToggle.querySelector('i').className = savedTheme === 'dark' ? 'fa-solid fa-sun' : 'fa-solid fa-moon';

            document.getElementById('settingsToggle').addEventListener('click', () => {
                alert('Settings modal would open here.');
            });

            // Market Analyzer Functionality
            const runButton = document.getElementById('runButton');
            const syntheticMarketSelect = document.getElementById('syntheticMarket');
            const tradeTypeSelect = document.getElementById('tradeType');
            const numberOfTicksInput = document.getElementById('numberOfTicks');
            const currentPriceElement = document.getElementById('currentPrice');
            const liveEvenCountElement = document.getElementById('liveEvenCount');
            const liveOddCountElement = document.getElementById('liveOddCount');
            const evenProbabilityBar = document.getElementById('evenProbabilityBar');
            const oddProbabilityBar = document.getElementById('oddProbabilityBar');
            const evenProbabilityLabel = document.getElementById('evenProbabilityLabel');
            const oddProbabilityLabel = document.getElementById('oddProbabilityLabel');
            const recentPatternsContainer = document.getElementById('recentPatterns');

            const APP_ID = '99973';
            let liveDataWs = null;
            let liveEvenCount = 0;
            let liveOddCount = 0;
            let liveOverCount = 0;
            let liveUnderCount = 0;
            let liveMatchCount = 0;
            let liveDifferCount = 0;
            const recentPatterns = [];
            const maxPatterns = 20;

            function runAnalysis() {
                const marketSymbol = syntheticMarketSelect.value;
                const numberOfTicks = parseInt(numberOfTicksInput.value, 10);
                const tradeType = tradeTypeSelect.value;

                if (isNaN(numberOfTicks) || numberOfTicks < 1 || numberOfTicks > 5000) {
                    alert('Please enter a valid number of ticks (1-5000).');
                    return;
                }

                runButton.disabled = true;
                document.getElementById('runBtnText').textContent = 'Running...';
                document.getElementById('statusTag').classList.remove('not-running');
                document.getElementById('statusTag').classList.add('running');
                document.getElementById('statusTag').textContent = 'Running';

                liveEvenCount = 0;
                liveOddCount = 0;
                liveOverCount = 0;
                liveUnderCount = 0;
                liveMatchCount = 0;
                liveDifferCount = 0;
                liveEvenCountElement.textContent = liveEvenCount;
                liveOddCountElement.textContent = liveOddCount;
                recentPatterns.length = 0;

                try {
                    fetchHistoricalTicks(marketSymbol, numberOfTicks).then(historicalTicks => {
                        const counts = analyzeHistoricalTicks(historicalTicks, tradeType);
                        updateProbabilities(counts, tradeType);
                    });

                    subscribeToLiveTicks(marketSymbol, tradeType);
                } catch (error) {
                    console.error('Analysis failed:', error);
                    alert('Failed to start live data feed. Please check your connection and try again.');
                } finally {
                    setTimeout(() => {
                        runButton.disabled = false;
                        document.getElementById('runBtnText').textContent = 'Run Analysis';
                        document.getElementById('statusTag').classList.remove('running');
                        document.getElementById('statusTag').classList.add('not-running');
                        document.getElementById('statusTag').textContent = 'Not Running';
                    }, 2000);
                }
            }

            async function fetchHistoricalTicks(symbol, count) {
                const ws = new WebSocket(`wss://ws.derivws.com/websockets/v3?app_id=${APP_ID}`);
                return new Promise((resolve, reject) => {
                    ws.onopen = () => {
                        ws.send(JSON.stringify({
                            "ticks_history": symbol,
                            "end": "latest",
                            "count": count,
                            "style": "ticks"
                        }));
                    };
                    ws.onmessage = (msg) => {
                        const data = JSON.parse(msg.data);
                        if (data.msg_type === 'history') {
                            resolve(data.history.times.map((time, index) => ({
                                time: parseInt(time),
                                quote: data.history.prices[index]
                            })));
                            ws.close();
                        } else if (data.error) {
                            reject(new Error(data.error.message));
                            ws.close();
                        }
                    };
                    ws.onerror = (error) => {
                        reject(error);
                        ws.close();
                    };
                });
            }

            function analyzeHistoricalTicks(ticks, tradeType) {
                let evenCount = 0, oddCount = 0;
                let overCount = 0, underCount = 0;
                let matchCount = 0, differCount = 0;
                let firstDigit = null;

                ticks.forEach((tick, index) => {
                    const lastDigit = parseInt(tick.quote.toString().slice(-1), 10);
                    if (tradeType === 'Even/Odd') {
                        if (lastDigit % 2 === 0) evenCount++;
                        else oddCount++;
                    } else if (tradeType === 'Over/Under') {
                        if (lastDigit >= 5) overCount++;
                        else underCount++;
                    } else if (tradeType === 'Match/Differ') {
                        if (index === 0) firstDigit = lastDigit;
                        if (lastDigit === firstDigit) matchCount++;
                        else differCount++;
                    }
                });

                return { evenCount, oddCount, overCount, underCount, matchCount, differCount };
            }

            function subscribeToLiveTicks(symbol, tradeType) {
                if (liveDataWs) {
                    liveDataWs.close();
                }

                liveEvenCount = 0;
                liveOddCount = 0;
                liveOverCount = 0;
                liveUnderCount = 0;
                liveMatchCount = 0;
                liveDifferCount = 0;
                liveEvenCountElement.textContent = liveEvenCount;
                liveOddCountElement.textContent = liveOddCount;
                recentPatterns.length = 0;
                updateRecentPatternsUI(recentPatterns, tradeType);
                updateProbabilities({ evenCount: 0, oddCount: 0, overCount: 0, underCount: 0, matchCount: 0, differCount: 0 }, tradeType);

                liveDataWs = new WebSocket(`wss://ws.derivws.com/websockets/v3?app_id=${APP_ID}`);
                let firstDigit = null;

                liveDataWs.onopen = () => {
                    liveDataWs.send(JSON.stringify({
                        "ticks": symbol,
                        "subscribe": 1
                    }));
                };

                liveDataWs.onmessage = (msg) => {
                    const data = JSON.parse(msg.data);
                    if (data.msg_type === 'tick') {
                        const livePrice = data.tick.quote;
                        const lastDigit = parseInt(livePrice.toString().slice(-1), 10);

                        currentPriceElement.textContent = parseFloat(livePrice).toFixed(2);

                        if (recentPatterns.length >= maxPatterns) {
                            const oldDigit = recentPatterns.shift();
                            if (tradeType === 'Even/Odd') {
                                if (oldDigit % 2 === 0) liveEvenCount--;
                                else liveOddCount--;
                            } else if (tradeType === 'Over/Under') {
                                if (oldDigit >= 5) liveOverCount--;
                                else liveUnderCount--;
                            } else if (tradeType === 'Match/Differ') {
                                if (oldDigit === firstDigit) liveMatchCount--;
                                else liveDifferCount--;
                            }
                        }

                        recentPatterns.push(lastDigit);
                        if (tradeType === 'Even/Odd') {
                            if (lastDigit % 2 === 0) liveEvenCount++;
                            else liveOddCount++;
                            liveEvenCountElement.textContent = liveEvenCount;
                            liveOddCountElement.textContent = liveOddCount;
                        } else if (tradeType === 'Over/Under') {
                            if (lastDigit >= 5) liveOverCount++;
                            else liveUnderCount++;
                            liveEvenCountElement.textContent = liveOverCount;
                            liveOddCountElement.textContent = liveUnderCount;
                            liveEvenCountElement.parentElement.querySelector('.stat-label').textContent = 'Over';
                            liveOddCountElement.parentElement.querySelector('.stat-label').textContent = 'Under';
                        } else if (tradeType === 'Match/Differ') {
                            if (recentPatterns.length === 1) firstDigit = lastDigit;
                            if (lastDigit === firstDigit) liveMatchCount++;
                            else liveDifferCount++;
                            liveEvenCountElement.textContent = liveMatchCount;
                            liveOddCountElement.textContent = liveDifferCount;
                            liveEvenCountElement.parentElement.querySelector('.stat-label').textContent = 'Match';
                            liveOddCountElement.parentElement.querySelector('.stat-label').textContent = 'Differ';
                        }

                        updateRecentPatternsUI(recentPatterns, tradeType);
                        updateProbabilities({ evenCount: liveEvenCount, oddCount: liveOddCount, overCount: liveOverCount, underCount: liveUnderCount, matchCount: liveMatchCount, differCount: liveDifferCount }, tradeType);
                    }
                };

                liveDataWs.onclose = () => {
                    liveDataWs = new WebSocket(`wss://ws.derivws.com/websockets/v3?app_id=${APP_ID}`);
                    liveDataWs.onopen = () => {
                        liveDataWs.send(JSON.stringify({ ticks: symbol, subscribe: 1 }));
                    };
                };
            }

            function updateRecentPatternsUI(patterns, tradeType) {
                recentPatternsContainer.innerHTML = '';
                patterns.forEach(digit => {
                    const dotContainer = document.createElement('div');
                    dotContainer.className = 'dot-container';
                    const dot = document.createElement('div');
                    dot.className = 'dot';
                    dot.textContent = digit;
                    const label = document.createElement('div');
                    label.className = 'dot-label';

                    if (tradeType === 'Even/Odd') {
                        if (digit % 2 === 0) {
                            dot.classList.add('even-dot');
                            label.textContent = 'Even';
                        } else {
                            dot.classList.add('odd-dot');
                            label.textContent = 'Odd';
                        }
                    } else if (tradeType === 'Over/Under') {
                        if (digit >= 5) {
                            dot.classList.add('even-dot');
                            label.textContent = 'Over';
                        } else {
                            dot.classList.add('odd-dot');
                            label.textContent = 'Under';
                        }
                    } else if (tradeType === 'Match/Differ') {
                        const firstDigit = patterns[0];
                        if (digit === firstDigit) {
                            dot.classList.add('even-dot');
                            label.textContent = 'Match';
                        } else {
                            dot.classList.add('odd-dot');
                            label.textContent = 'Differ';
                        }
                    }

                    dotContainer.appendChild(dot);
                    dotContainer.appendChild(label);
                    recentPatternsContainer.appendChild(dotContainer);
                });
            }

            function updateProbabilities(counts, tradeType) {
                let count1, count2, label1, label2;
                if (tradeType === 'Even/Odd') {
                    count1 = counts.evenCount;
                    count2 = counts.oddCount;
                    label1 = 'Even';
                    label2 = 'Odd';
                } else if (tradeType === 'Over/Under') {
                    count1 = counts.overCount;
                    count2 = counts.underCount;
                    label1 = 'Over';
                    label2 = 'Under';
                } else if (tradeType === 'Match/Differ') {
                    count1 = counts.matchCount;
                    count2 = counts.differCount;
                    label1 = 'Match';
                    label2 = 'Differ';
                }

                const total = count1 + count2;
                if (total > 0) {
                    const prob1 = ((count1 / total) * 100).toFixed(2);
                    const prob2 = ((count2 / total) * 100).toFixed(2);
                    evenProbabilityBar.style.width = `${prob1}%`;
                    oddProbabilityBar.style.width = `${prob2}%`;
                    evenProbabilityLabel.textContent = `${prob1}%`;
                    oddProbabilityLabel.textContent = `${prob2}%`;
                    document.querySelector('.probability-label span:first-child').textContent = label1;
                    document.querySelector('.probability-label span:last-child').textContent = label2;
                } else {
                    evenProbabilityBar.style.width = '50%';
                    oddProbabilityBar.style.width = '50%';
                    evenProbabilityLabel.textContent = '50%';
                    oddProbabilityLabel.textContent = '50%';
                    document.querySelector('.probability-label span:first-child').textContent = label1;
                    document.querySelector('.probability-label span:last-child').textContent = label2;
                }
            }

            runButton.addEventListener('click', runAnalysis);
            syntheticMarketSelect.addEventListener('change', () => {
                const newSymbol = syntheticMarketSelect.value;
                const tradeType = tradeTypeSelect.value;
                liveEvenCount = 0;
                liveOddCount = 0;
                liveOverCount = 0;
                liveUnderCount = 0;
                liveMatchCount = 0;
                liveDifferCount = 0;
                liveEvenCountElement.textContent = liveEvenCount;
                liveOddCountElement.textContent = liveOddCount;
                recentPatterns.length = 0;
                updateRecentPatternsUI(recentPatterns, tradeType);
                updateProbabilities({ evenCount: 0, oddCount: 0, overCount: 0, underCount: 0, matchCount: 0, differCount: 0 }, tradeType);
                subscribeToLiveTicks(newSymbol, tradeType);
            });
            tradeTypeSelect.addEventListener('change', () => {
                const tradeType = tradeTypeSelect.value;
                liveEvenCount = 0;
                liveOddCount = 0;
                liveOverCount = 0;
                liveUnderCount = 0;
                liveMatchCount = 0;
                liveDifferCount = 0;
                liveEvenCountElement.textContent = liveEvenCount;
                liveOddCountElement.textContent = liveOddCount;
                recentPatterns.length = 0;
                updateRecentPatternsUI(recentPatterns, tradeType);
                updateProbabilities({ evenCount: 0, oddCount: 0, overCount: 0, underCount: 0, matchCount: 0, differCount: 0 }, tradeType);
                subscribeToLiveTicks(syntheticMarketSelect.value, tradeType);
            });
            numberOfTicksInput.addEventListener('input', () => {
                if (numberOfTicksInput.value < 1) numberOfTicksInput.value = 1;
                if (numberOfTicksInput.value > 5000) numberOfTicksInput.value = 5000;
            });

            // Initialize
            subscribeToLiveTicks(syntheticMarketSelect.value, tradeTypeSelect.value);
        });
    </script>
</body>
</html>